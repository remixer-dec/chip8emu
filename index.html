<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="theme-color" content="#101010">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Chip-8 interactive emulator | experimental project</title>
	<link rel="import" href="opcode.html">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="./style.css" rel="stylesheet">
	</head>
<body>
	<div id="beep"></div>
	<div id="theme"></div>
	<div id="topframe">
		<canvas id="escreen"></canvas>
		<div id="controls">
			<button>1</button>
			<button>2</button>
			<button>3</button>
			<button>C</button>
			<button>4</button>
			<button>5</button>
			<button>6</button>
			<button>D</button>
			<button>7</button>
			<button>8</button>
			<button>9</button>
			<button>E</button>
			<button>A</button>
			<button>0</button>
			<button>B</button>
			<button>F</button>
		</div>
	</div>
	<div id="dbgc">
		<i id="stepbtn" class="material-icons">keyboard_tab</i>
		<i id="plpbtn" class="material-icons">pause</i>
		<i id="resetbtn" class="material-icons">replay</i>
		<i id="stopemu" class="material-icons">stop</i>
		<input id="romselector" type="file">
		<label for="romselector" class="material-icons">folder</label>
	</div>
	<div id="debug">
		<div id="instructions">
			<label for="presetcfg"><u>Select configuration preset</u></label>
			<select id="presetcfg">
				<option value="0" selected>Custom</option>
				<option value="1">Optimal performance</option>
				<option value="2">Maximum speed</option>
				<option value="3">Smooth gameplay</option>
				<option value="4">Live debugging</option>
				<option value="5">Postponed debugging</option>
			</select>
			<label for="romcfg"><u>Load ROM from the list</u></label>
			<select id="romcfg">
				<option value="0">Not selected</option>
				<option value="1">15PUZZLE</option>
				<option value="2">BLINKY</option>
				<option value="3">BLITZ</option>
				<option value="4">BRIX</option>
				<option value="5">CONNECT4</option>
				<option value="6">GUESS</option>
				<option value="7">HIDDEN</option>
				<option value="8">INVADERS</option>
				<option value="9">KALEID</option>
				<option value="10">MAZE</option>
				<option value="11">MERLIN</option>
				<option value="12">MISSILE</option>
				<option value="13">PONG</option>
				<option value="14">PONG2</option>
				<option value="15">PUZZLE</option>
				<option value="16">SYZYGY</option>
				<option value="17">TANK</option>
				<option value="18">TETRIS</option>
				<option value="19">TICTAC</option>
				<option value="20">UFO</option>
				<option value="21">VBRIX</option>
				<option value="22">VERS</option>
				<option value="23">WIPEOFF</option>
			</select>
			<label for="damodecfg">Order of parsing</label>
			<select id="damodecfg">
				<option value="0">Linear</option>
				<option value="1" selected>Executional</option>
			</select>

			<label for="exmodecfg">Rendering mode</label>
			<select id="exmodecfg">
				<option value="0" selected>Live-view</option>
				<option value="1">Pre-render</option>
			</select>
			<label for="debugcfg">Debug mode</label>
			<select id="debugcfg">
				<option value="0">Console with states</option>
				<option value="1" selected>Console only</option>
				<option value="2">No console (fastest)</option>
			</select>
			<label for="regcfg">Register information</label>
			<select id="regcfg">
				<option value="0">Static registers</option>
				<option value="1" selected>Live registers (slower)</option>
			</select>
			<label for="btnstcfg">Button sticking</label>
			<select id="btnstcfg">
				<option value="0" selected>OFF</option>
				<option value="1">ON</option>
			</select>
			<label for="fpscfg">Instructions per frame</label>
			<select id="fpscfg">
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
				<option value="6">6</option>
				<option value="10">10</option>
				<option value="16">16</option>
				<option value="30">30</option>
				<option value="60">60</option>
				<option value="144">144</option>
				<option value="1000">onDraw</option>
				<option value="2000">onDraw x2</option>
				<option value="3000">onDraw x3</option>
				<option value="4000">onDraw x4</option>
				<option value="5000">onDraw x5</option>
				<option value="6000">onDraw x6</option>
				<option value="7000">onDraw x7</option>
				<option value="8000">onDraw x8</option>
				<option value="9000">onDraw x9</option>
				<option value="10000">onDraw x10</option>
			</select>
			<label for="delaycfg">Artificial delay between frames</label>
			<select id="delaycfg">
				<option value="0" selected>No delay</option>
				<option value="16">16ms</option>
				<option value="33">33ms</option>
				<option value="60">60ms</option>
				<option value="100">100ms</option>
				<option value="200">200ms</option>
				<option value="500">500ms</option>
			</select>
			<label for="rendercfg">Render quality</label>
			<select id="rendercfg">
				<option value="1" selected>HD</option>
				<option value="0">SD</option>
			</select>
			<label for="gameovercfg">End game behavior</label>
			<select id="gameovercfg">
				<option value="0">Show last frame</option>
				<option value="1">Show GameOver screen</option>
				<option value="2" selected>G/O screen + autoreset</option>
			</select>
			<label for="blinkcfg">Blink reduction strategy</label>
			<select id="blinkcfg">
				<option value="0">Disabled</option>
				<option value="1">vFFrameSkip</option>
				<option value="2">Multi-staged vFFrameSkip</option>
			</select>
			<span id="opwrapper">
				<div id="opcodeview"></div>
			</span>
			<div id="registers">
				<p id="rv0" name="v0" v="0"></p>
				<p id="rv1" name="v1" v="0"></p>
				<p id="rv2" name="v2" v="0"></p>
				<p id="rv3" name="v3" v="0"></p>
				<p id="rv4" name="v4" v="0"></p>
				<p id="rv5" name="v5" v="0"></p>
				<p id="rv6" name="v6" v="0"></p>
				<p id="rv7" name="v7" v="0"></p>
				<p id="rv8" name="v8" v="0"></p>
				<p id="rv9" name="v9" v="0"></p>
				<p id="rv10" name="vA" v="0"></p>
				<p id="rv11" name="vB" v="0"></p>
				<p id="rv12" name="vC" v="0"></p>
				<p id="rv13" name="vD" v="0"></p>
				<p id="rv14" name="vE" v="0"></p>
				<p id="rv15" name="vF" v="0"></p>
				<p id="rvI" name="I"  v="0"></p>
			</div>
		</div>
		<div>
			<h5>Changelog</h5>
			<u>v0.1.3</u>
			Added blink reduction strategy, added configuration presets.
			<br>
			<u>v0.1.1, v0.1.2</u>
			Bugfixes
			<br>
			<u>v0.1.0</u>
			Design improvements, partial refactoring, added remote ROM loader. Fixed bugs.
			<br>
			<u>v0.0.9</u>
			Mobile UI, Live register info
			<br>
			<u>v0.0.8</u>
			Separated debug code, implemented sound timer as a diode
			<br>
			<u>v0.0.7</u>
			HD/SD renderer & gameover screen now can be choosen from configuration. Reset button now is working.
			<br>
			<u>v0.0.6</u>
			OnDraw render mode is now working, and it can take multiple drawCalls before rendering. This can decrease blinking in some games. But some other games have no-draw loops, which can freeze some browsers.
			Fixed overflow of sum opcode, added delay configurations.
			<br>
			<u>v0.0.5</u>
			Accurate collision detection, bugfixes, partial refactoring, step-by-step mode, keyboard sticking.
			<br>
			<u>v0.0.4</u>
			Added chrome support, fixed bugs, implemented timers.
			<br>
			<u>v0.0.3</u>
			Keyboard, fonts, more opcodes, vF register, more configurations, bug fixes
			<br>
			<u>v0.0.2</u>
			Every string to number convertion (except debugger) has been re-implemented as number only.
			New rendering engine, draws a full frame instead of drawing every single pixel.
			A lot of ROMs are loadable now.
			<br>
			<u>v0.0.1</u>
			This is my first attempt of recreation an emulator, without looking into other people's code. Here are a lot of things that are done wrong, and the only working ROM is MAZE.
			Also, this project is using web components and JS imports, so you need a modern browser to run it.
		</div>
	</div>
	<h5>Opcode description</h5>
	<script type="module" src="main.js">
	</script>
	<script>

	window.onload = ()=>{
		setTimeout(()=>{
			/*web components imports experiment*/
			var post = document.querySelector('link[rel="import"]').import;
			var article = post.querySelector('table');
			document.body.appendChild(article.cloneNode(true))
		},500);
	}
	</script>
	<script src="https://rawcdn.githack.com/webcomponents/html-imports/de54e600e1de4b7bf05f3e2ba9f3ff964521bd71/html-imports.min.js"></script>
	<script src="https://rawcdn.githack.com/FremyCompany/css-grid-polyfill/954d4383fda701c334ece4fc2e6834ef703aaa1a/bin/css-polyfills.min.js"></script>
</body>
</html>
